<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}Archive System{% endblock %}</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" rel="stylesheet">
  {% load static %}
  <meta name="csrf-token" content="{{ csrf_token }}">
  {% block styles %}{% endblock %}
  <link rel="stylesheet" type="text/css" href="{% static 'css/base.css' %}">
</head>
<body class="bg-white">
    {% if not user.is_authenticated %}
    <!-- Navbar -->
    <nav class="bg-white text-green-600 p-4 z-10 w-full top-0 left-0">
      <div class="container mx-auto flex justify-between items-center">
        <div class="flex items-center space-x-2">
          <img src="{% static 'img/fowse.png' %}" class="h-10 inline-block" alt="Fowse Logo" />
          <h1 class="text-xl font-bold text-green-600">Fowse</h1>
        </div>
      </div>
    </nav>
    <!-- Scrollable Content -->
      <!-- Hero Section -->
      <section
        class="relative flex items-center justify-center"
        style="
          background-color: white;
          background-image: url('{% static 'img/background_fowse.png' %}');
          background-size: auto;
          background-position: center top;
          background-repeat: no-repeat;
          height: calc(100vh - 64px);
          opacity: 0.3;
        "
      >
      </section>
        <!-- Hero card -->
        <div class="absolute inset-x-0 bottom-1/4 flex items-center justify-center text-center max-w-5xl mx-auto">
          <div>
            <h1 class="text-6xl font-semibold text-black mb-4 whitespace-nowrap text-center">
              All Your Docs, One Smart Search
            </h1>
            <p class="text-gray-600 mb-8 text-lg leading-relaxed max-w-xl mx-auto">
              <span class="font-bold text-black">Built for seamless internal use,</span>
              <span class="font-semibold text-black"> Fowse</span>
              enables you to instantly locate, verify, and manage documents with AI precision.
            </p>
            <a href="{% url 'login' %}"
              class="px-16 py-3 bg-green-600 text-white rounded-full font-semibold 
          shadow-sm hover:bg-green-700 transition"
              style="box-shadow: 0 2px 4px rgba(0,0,0,0.25);">
              Log in
            </a>
          </div>
        </div>
        <!-- Features Section -->
        <!-- Left Column (Text) -->
          <div class="flex items-start justify-center border-b-2 py-16 pt-4">
            <div class="w-full md:w-1/2 px-4 flex flex-col items-center justify-center text-center mx-auto">
              <h2 class="text-4xl font-semibold text-gray-800 mb-4">
                Discover what makes <span class="text-green-600">Fowse</span> the easiest way to
                <span class="text-green-600">manage</span> your documents.
              </h2>
                 <div class="inline-flex items-center bg-white rounded-full p-1 mt-6 border border-gray-300">
                      <button id="chatButton" class="px-8 py-3 text-white bg-green-600 rounded-full font-semibold transition-all duration-300">
                          Chat
                      </button>
                      <button id="searchButton" class="px-8 py-3 text-gray-600 bg-transparent rounded-full font-semibold transition-all duration-300">
                          Search
                      </button>
                </div>
            </div>
          </div>

        <div class="flex flex-col md:flex-row">
          <!-- Left Column: Text Content -->
          <div class="w-full md:w-1/2">
            <!-- Chat Panel Content -->
            <div id="chatPanelText" class="p-6 md:p-8 border-b-2 md:border-b-0 md:border-r-2">
              <h1 class="text-black mb-6 text-xl md:text-2xl font-semibold text-left">
                Context-aware document chat
              </h1>
              <ul class="list-disc pl-5 text-black text-left space-y-2">
                <li><span class="font-bold">Document Chat:</span> Chat directly with your documents to quickly extract key details, summaries, and explanations.</li>
                <li><span class="font-bold">Context-aware assistance:</span> Fowse Chat understands the context of your files, letting you refine queries and surface exactly the information you need.</li>
                <li><span class="font-bold">Flexible interaction:</span> Get quick summaries, detailed insights, or step-by-step explanations to fit your workflow.</li>
              </ul>
            </div>

            <!-- Search Panel Content - Initially hidden -->
            <div id="searchPanelText" class="p-6 md:p-8 border-b md:border-b-0 md:border-r hidden">
              <h1 class="text-black mb-6 text-xl md:text-2xl font-semibold text-left">
                Intelligent document search
              </h1>
              <ul class="list-disc pl-5 text-black text-left space-y-2">
                <li><span class="font-bold">Fast Search:</span> Find documents instantly using natural language queries and advanced filtering options.</li>
                <li><span class="font-bold">Smart Filtering:</span> Narrow results with filters, tags, and
                metadata so you always land on the exact file you need.</li>
                <li><span class="font-bold">Scalable Performance:</span> Whether you're searching a few files or 
                thousands, Fowse Search delivers results quickly and reliably.</li>
              </ul>
            </div>
          </div>

          <!-- Right Column: Image Placeholder -->
          <div class="m-auto">
            <!-- Content Container for the panels (Chat/Search) -->
            <div id="contentPanel" class="mt-6">
              <div id="chatPanel" class="flex justify-center">
                <div class="w-full max-w-lg aspect-video rounded-2xl overflow-hidden shadow-lg">
                  <img src="{% static 'img/background_fowse.png' %}" 
                      alt="Chat Panel" 
                      class="w-full h-full object-cover">
                </div>
              </div>

              <!-- Search Panel -->
              <div id="searchPanel" class="flex justify-center hidden">
                <div class="w-full max-w-lg aspect-video rounded-2xl overflow-hidden shadow-lg">
                  <img src="{% static 'img/background_fowse.png' %}" 
                      alt="Search Panel" 
                      class="w-full h-full object-cover">
                </div>
              </div>
            </div>
          </div>
        </div>

      <!-- Another Section -->
      <section class="bg-white py-10 border-2 border-solid border-gray-200">
        <div class="mx-auto max-w-6xl px-4">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6 lg:gap-8 items-stretch">

            <!-- Card: Search Filter -->
            <article class="flex flex-col rounded-3xl border border-gray-300 bg-gray-50 p-6 md:p-8 shadow-sm min-h-[420px]">
              <header class="flex items-start gap-4">
                <i class="fa-solid fa-filter text-black text-6xl md:text-7xl leading-none"></i>
                <div>
                  <h3 class="text-2xl md:text-3xl font-semibold text-gray-900">Search Filter</h3>
                  <p class="mt-2 text-gray-600 max-w-sm">
                    Narrow it down fast. Sort by tags, dates, or file types to find exactly what you need.
                  </p>
                </div>
              </header>

              <!-- Image block -->
              <div class="mt-8 flex-1">
                <div class="relative mx-auto w-full max-w-[560px]">
                  <!-- Placeholder container -->
                  <div class="rounded-2xl bg-white p-2 md:p-3 ring-2 ring-gray-200">
                    <!-- Image inside container -->
                    <div class="aspect-[16/9] w-full overflow-hidden rounded-xl bg-white shadow-lg">
                      <img
                        src="{% static 'img/background_fowse.png' %}"
                        alt="Advanced Search"
                        class="h-full w-full object-cover"
                      />
                    </div>
                  </div>
                  <!-- Floor shadow -->
                  <div
                    class="pointer-events-none absolute left-1/2 top-full -mt-3 h-8 w-10/12 -translate-x-1/2 rounded-full bg-black/25 opacity-30 blur-2xl">
                  </div>
                </div>
              </div>
            </article>

            <!-- Card: Intelligent Chat -->
            <article class="flex flex-col rounded-3xl border border-gray-300 bg-gray-50 p-6 md:p-8 shadow-sm min-h-[420px]">
              <header class="flex items-start gap-4">
                <i class="fa-solid fa-comments text-black text-6xl md:text-7xl leading-none"></i>
                <div>
                  <h3 class="text-2xl md:text-3xl font-semibold text-gray-900">Intelligent Chat</h3>
                  <p class="mt-2 text-gray-600 max-w-sm">
                    Skip the digging. Just ask RaFile and get summaries, answers, or insights straight from your documents.
                  </p>
                </div>
              </header>

              <div class="mt-8 flex-1">
                <div class="relative mx-auto w-full max-w-[560px]">
                  <div class="rounded-2xl bg-white p-2 md:p-3 ring-2 ring-gray-200">
                    <div class="aspect-[16/9] w-full overflow-hidden rounded-xl bg-white shadow-lg">
                      <img
                        src="{% static 'img/background_fowse.png' %}"
                        alt="Chat Preview"
                        class="h-full w-full object-cover"
                      />
                    </div>
                  </div>
                  <div
                    class="pointer-events-none absolute left-1/2 top-full -mt-3 h-8 w-10/12 -translate-x-1/2 rounded-full bg-black/25 opacity-30 blur-2xl">
                  </div>
                </div>
              </div>
            </article>

          </div>
        </div>
      </section>

      <!-- More sections can be added here -->
       <div class="py-16 bg-gray-100">
        <h2 class="text-4xl text-center font-semibold text-gray-800">Grid & List View</h2>
        <p class="text-center mt-4 text-gray-600">Another piece of content for the page.</p>
      </div>
      
      <section class="bg-white py-10 border-2 border-solid border-gray-200">
        <div class="mx-auto max-w-6xl px-4">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6 lg:gap-8 items-stretch">

            <!-- Card: Search Filter -->
            <article class="flex flex-col rounded-3xl border border-gray-300 bg-gray-50 p-6 md:p-8 shadow-sm min-h-[420px]">
              <header class="flex items-start gap-4">
                <i class="fa-regular fa-file-lines text-black text-6xl md:text-7xl leading-none"></i>
                <div>
                  <h3 class="text-2xl md:text-3xl font-semibold text-gray-900">OCR Tooltips</h3>
                  <p class="mt-2 text-gray-600 max-w-sm">
                    Narrow it down fast. Sort by tags, dates, or file types to find exactly what you need.
                  </p>
                </div>
              </header>

              <!-- Image block -->
              <div class="mt-8 flex-1">
                <div class="relative mx-auto w-full max-w-[560px]">
                  <!-- Placeholder container -->
                  <div class="rounded-2xl bg-white p-2 md:p-3 ring-2 ring-gray-200">
                    <!-- Image inside container -->
                    <div class="aspect-[16/9] w-full overflow-hidden rounded-xl bg-white shadow-lg">
                      <img
                        src="{% static 'img/background_fowse.png' %}"
                        alt="Advanced Search"
                        class="h-full w-full object-cover"
                      />
                    </div>
                  </div>
                  <!-- Floor shadow -->
                  <div
                    class="pointer-events-none absolute left-1/2 top-full -mt-3 h-8 w-10/12 -translate-x-1/2 rounded-full bg-black/25 opacity-30 blur-2xl">
                  </div>
                </div>
              </div>
            </article>

            <!-- Card: Intelligent Chat -->
            <article class="flex flex-col rounded-3xl border border-gray-300 bg-gray-50 p-6 md:p-8 shadow-sm min-h-[420px]">
              <header class="flex items-start gap-4">
                <i class="fa-solid fa-magnifying-glass text-black text-6xl md:text-7xl leading-none"></i>
                <div>
                  <h3 class="text-2xl md:text-3xl font-semibold text-gray-900">AI Search</h3>
                  <p class="mt-2 text-gray-600 max-w-sm">
                    Skip the digging. Just ask RaFile and get summaries, answers, or insights straight from your documents.
                  </p>
                </div>
              </header>

              <div class="mt-8 flex-1">
                <div class="relative mx-auto w-full max-w-[560px]">
                  <div class="rounded-2xl bg-white p-2 md:p-3 ring-2 ring-gray-200">
                    <div class="aspect-[16/9] w-full overflow-hidden rounded-xl bg-white shadow-lg">
                      <img
                        src="{% static 'img/background_fowse.png' %}"
                        alt="Chat Preview"
                        class="h-full w-full object-cover"
                      />
                    </div>
                  </div>
                  <div
                    class="pointer-events-none absolute left-1/2 top-full -mt-3 h-8 w-10/12 -translate-x-1/2 rounded-full bg-black/25 opacity-30 blur-2xl">
                  </div>
                </div>
              </div>
            </article>

          </div>
        </div>
      </section>

      <!-- Footer Section -->
      <footer class="bg-gray-100 text-gray-800 py-12 mt-auto">
          <div class="container mx-auto px-4 h-full">
              <div class="grid grid-cols-1 md:grid-cols-4 gap-8 h-full">
            
            <!-- Company Info -->
            <div class="md:col-span-2">
                <div class="flex items-center space-x-3 mb-4">
                <img src="{% static 'img/fowse.png' %}" class="h-8 w-8" alt="Fowse Logo" />
                <h3 class="text-xl font-bold">Fowse</h3>
              </div>
                <p class="text-gray-600 text-md max-w-md">
                All Your Docs, One Smart Search. Built for seamless internal use, 
                Fowse enables you to instantly locate, verify, and manage documents with AI precision.
              </p>
            </div>

            <!-- Quick Links -->
            <div>
              <h4 class="font-semibold mb-3">Quick Links</h4>
              <ul class="space-y-1.5">
                <li><a href="{% url 'login' %}" class="text-gray-600 hover:text-gray-800 transition">Login</a></li>
                <li><a href="#" class="text-gray-600 hover:text-gray-800 transition">Features</a></li>
                <li><a href="#" class="text-gray-600 hover:text-gray-800 transition">Help</a></li>
                <li><a href="#" class="text-gray-600 hover:text-gray-800 transition">Support</a></li>
              </ul>
            </div>

            <!-- Contact Info -->
            <div>
              <h4 class="font-semibold mb-3">Contact</h4>
              <ul class="space-y-1.5 text-gray-600">
                <li><i class="fa-solid fa-envelope mr-2"></i>support@fowse.com</li>
                <li><i class="fa-solid fa-phone mr-2"></i>099tutunogtunog</li>
                <li><i class="fa-solid fa-location-dot mr-2"></i>Mandaluyong, Philippines</li>
                <li><a href="https://cornersteelsystems.com" target="_blank" rel="noopener noreferrer" class="text-gray-600 hover:text-gray-800 transition"><i class="fa-solid fa-building mr-2"></i>Cornersteel Systems Corporation</a></li>
              </ul>
            </div>
        </div>

            <!-- Copyright -->
            <div class="border-t border-gray-300 mt-8 pt-8 text-center">
            <p class="text-gray-600 mb-4">
              Copyright &copy; 2025 Fowse. All rights reserved.
            </p>
            <div class="flex justify-center">
              <a href="https://github.com/Comfac-Global-Group/archive" target="_blank" rel="noopener noreferrer" 
                 class="text-gray-600 hover:text-gray-800 transition-colors">
                <i class="fa-brands fa-github text-2xl"></i>
              </a>
            </div>
            </div>
              </div>
      </footer>

    {% endif %}

    {% if user.is_authenticated and not hide_sidebar %}
    <div class="min-h-screen flex bg-white">
    <!-- Sidebar (only shows if logged in) -->
    <aside id="logo-sidebar" class="fixed inset-y-0 left-0 z-40 bg-white shadow" aria-label="Sidebar">

      <div class="h-full flex flex-col bg-gray-200">
        <!-- Brand + Collapse -->
        <div class="flex items-center justify-between px-2.5 py-3 border-b-2 border-gray-300">
          <button id="brandToggle"
            class="flex items-center space-x-2 px-2.5 py-2 w-full overflow-hidden focus:outline-none hover:opacity-90"
            type="button" aria-label="Toggle sidebar" aria-pressed="false">
            <img src="{% static 'img/fowse.png' %}"
           class="h-8 w-8 rounded-full object-cover inline-block" alt="Fowse Logo" />
            <span class="brand-text text-lg font-semibold whitespace-nowrap">Fowse</span>
          </button>
          <button id="collapseSidebar"
                  class="hidden sm:inline-flex items-center justify-center w-8 h-8 rounded hover:bg-gray-100 text-gray-600"
                  type="button" aria-label="Collapse sidebar" aria-expanded="true">
            <i class="fa-solid fa-angles-left text-sm"></i>
          </button>
        </div>

        <!-- Apps in Nav -->
        <nav class="px-2 py-2" style="height: calc(100vh - 140px); display: flex; flex-direction: column;"> <!-- px-2 py-3→px-2 py-2, using calculated height -->
          <!-- Navigation buttons -->
          <div class="space-y-1 flex-shrink-0">
            <a href="{% url 'search_form' %}"
              class="group relative flex items-center gap-2.5 px-2.5 py-2 rounded-md hover:bg-green-50 text-gray-800 transition-colors">
              <i class="fa-solid fa-pen-to-square text-base shrink-0"></i> <!-- text-lg→base -->
              <span class="item-label">Document</span>
              <span class="item-tooltip pointer-events-none absolute left-11 top-1/2 -translate-y-1/2 whitespace-nowrap rounded bg-gray-800 text-white text-xs px-2 py-1 opacity-0 group-hover:opacity-100">Document</span>
            </a>

            <a href="{% url 'dashboard' %}"
              class="group relative flex items-center gap-2.5 px-2.5 py-2 rounded-md hover:bg-green-50 text-gray-800 transition-colors">
              <i class="fa-regular fa-file text-base shrink-0"></i>
              <span class="item-label">New Chat</span>
              <span class="item-tooltip pointer-events-none absolute left-11 top-1/2 -translate-y-1/2 whitespace-nowrap rounded bg-gray-800 text-white text-xs px-2 py-1 opacity-0 group-hover:opacity-100">New Chat</span>
            </a>
          </div>

          <!-- Chat History Section -->
          <div class="pt-2 flex-1 chat-history-section" style="display: flex; flex-direction: column; min-height: 0;">
            <div class="item-label px-2 py-1 text-xs font-semibold text-gray-500 uppercase tracking-wider flex-shrink-0">
              History ({{ conversations|length }} conversations)
            </div>
            <div id="chatHistory" class="space-y-1 overflow-y-auto" style="flex: 1; height: 0;">
              {% if conversations %}
                {% for conversation in conversations %}
                  <div class="group relative chat-history-item" data-conversation-id="{{ conversation.id }}" data-conversation-title="{{ conversation.title }}">
                    <a href="{% url 'dashboard_conversation' conversation.id %}"
                      class="flex items-center gap-2.5 px-2.5 py-2 rounded-md hover:bg-green-50 text-gray-800 transition-colors text-sm
                      {% if current_conversation and current_conversation.id == conversation.id %}bg-green-100{% endif %}">
                      <i class="fa-regular fa-message text-sm shrink-0"></i>
                      <span class="item-label truncate flex-1">{{ conversation.title }}</span>
                      <!-- Three dots menu button -->
                      <button onclick="showContextMenu(event, this.closest('.chat-history-item')); event.preventDefault(); event.stopPropagation();" 
                        class="opacity-0 group-hover:opacity-100 w-6 h-6 flex items-center justify-center text-gray-400 hover:text-gray-600 transition-all rounded hover:bg-gray-100 ml-1 menu-button">
                        <i class="fa-solid fa-ellipsis text-sm"></i>
                      </button>
                    </a>
                  </div>
                {% endfor %}
              {% else %}
                <p class="item-label px-2.5 py-2 text-xs text-gray-500">No conversations yet - Send a message to start!</p>
              {% endif %}
            </div>
          </div>
        </nav>

        <!-- User -->
        <div class="px-2 py-3 border-t-2 border-gray-300 flex-shrink-0"> <!-- py-2→py-1, added flex-shrink-0 -->
          <div class="group relative w-full overflow-visible">
            <button id="userMenuButton"
                    class="group relative flex items-center gap-2.5 px-2.5 py-1.5 w-full rounded-md hover:bg-green-50 text-gray-800 transition-colors"> <!-- py-2→py-1.5 -->
              <i class="fa-solid fa-user text-base shrink-0"></i>
              <span class="item-label">{{ user.username }}</span>
              <svg class="item-label w-4 h-4 ml-auto transition-transform duration-150" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
              </svg>
              <span class="item-tooltip pointer-events-none absolute left-11 top-1/2 -translate-y-1/2 whitespace-nowrap rounded bg-gray-800 text-white text-xs px-2 py-1 opacity-0 group-hover:opacity-100">{{ user.username }}</span>
            </button>

            <!-- Dropdown (upward by default; flyout when collapsed) -->
            <div id="userDropdown"
                  class="user-menu-panel hidden absolute left-0 bottom-full mb-2 w-full bg-white rounded-xl shadow-xl ring-1 ring-gray-200 py-2 z-60">
              <a href="{% url 'change_password' %}" class="block px-4 py-2 text-sm text-gray-800 hover:bg-gray-100 rounded-md">Change Password</a>
              <hr class="border-gray-200 my-1">
              <a href="{% url 'logout' %}" class="block px-4 py-2 text-sm text-gray-800 hover:bg-gray-100 rounded-md">Logout</a>
            </div>
          </div>
        </div>
      </div>
    </aside>
    {% endif %}

    <!-- Context Menu for Chat History -->
    <div id="chatContextMenu" class="hidden fixed bg-white rounded-lg shadow-lg border py-2 z-50 min-w-32">
      <button onclick="renameChatItem()" class="flex items-center gap-3 w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors">
        <i class="fa-solid fa-edit text-gray-500"></i>
        <span>Rename</span>
      </button>
      <button onclick="deleteChatItem()" class="flex items-center gap-3 w-full px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition-colors">
        <i class="fa-solid fa-trash text-red-500"></i>
        <span>Delete</span>
      </button>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteConfirmModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
      <div class="bg-white rounded-lg p-6 max-w-sm w-full mx-4 shadow-xl">
        <div class="flex items-center gap-3 mb-4">
          <div class="w-8 h-8 bg-red-100 rounded-full flex items-center justify-center">
            <i class="fa-solid fa-exclamation-triangle text-red-600"></i>
          </div>
          <h3 class="text-lg font-semibold text-gray-900">Permanently delete</h3>
        </div>
        <p class="text-gray-700 mb-6">Are you sure you want to delete this conversation?</p>
        <div class="flex gap-3 justify-end">
          <button onclick="cancelDelete()" class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors">Cancel</button>
          <button onclick="confirmDelete()" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors">OK</button>
        </div>
      </div>
    </div>

    <!-- Rename Modal -->
    <div id="renameModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
      <div class="bg-white rounded-lg p-6 max-w-sm w-full mx-4 shadow-xl">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">Rename Conversation</h3>
        <input id="renameInput" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 mb-6" placeholder="Enter new name">
        <div class="flex gap-3 justify-end">
          <button onclick="cancelRename()" class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors">Cancel</button>
          <button onclick="confirmRename()" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors">Save</button>
        </div>
      </div>
    </div>

    <!-- PAGE-SPECIFIC CONTENT -->
    <div id="pageContent" class="flex-1 container mx-auto mt-8 {% if hide_sidebar %}no-sidebar{% endif %}">
      {% block content %}{% endblock %}
    </div>

    <!-- JavaScript at the end for better performance -->
    <script src="{% static 'js/base.js' %}"></script>
    {% block scripts %}{% endblock %}
</body>
</html>