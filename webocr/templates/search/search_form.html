{% extends 'base.html' %}

{% block title %}Search Documents - Archive System{% endblock %}
{% block page_title %}Document Search{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto p-6 space-y-6">
    <!-- Search Interface -->
    <div class="bg-white p-8 rounded-2xl shadow-lg border border-gray-100">
        <div class="text-center mb-8">
            <h2 class="text-3xl font-bold text-gray-800 mb-2">Find Your Documents</h2>
            <p class="text-gray-600">Use natural language to search through your document archive</p>
        </div>

        <form method="post" action="{% url 'search_documents' %}" enctype="multipart/form-data" class="space-y-6">
        {% csrf_token %}

            <!-- Textarea -->
            <div>
                <label for="search_query" class="block text-lg font-medium text-gray-700 mb-3">
                What are you looking for?
                </label>
                <textarea
                name="search_query"
                id="search_query"
                rows="4"
                placeholder="Try: 'AIRCOND invoices over 50k from March' or 'Show me all contracts from ABC Company'"
                class="w-full px-6 py-4 border border-green-700 rounded-2xl focus:outline-none 
                focus:border-green-600 focus:ring-2 focus:ring-green-600 resize-none text-lg mb-4"
                required>{{ request.POST.search_query }}</textarea>
            </div>

            <!-- Buttons row -->
            <div class="flex items-center space-x-4">
                <!-- Search button -->
                <button
                type="submit" id="search-btn" rows="4"
                class="inline-flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white
                        font-semibold px-6 py-3 rounded-full transition-colors duration-200"
                >
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none"
                    viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                </svg>
                Search Documents
                </button>

                <!-- Upload File button -->
                <label
                for="document_file"
                class="inline-flex items-center gap-2 bg-green-50 text-green-800
                        px-4 py-2 rounded-full border border-green-200 hover:bg-green-100 cursor-pointer"
                >
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none"
                    viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M7 16V4h6l4 4v12a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2z"/>
                </svg>
                Upload File
                <input type="file" id="document_file" name="document_file" class="hidden" />
                </label>

                <!-- Upload Image button -->
                <label
                for="document_image"
                class="inline-flex items-center gap-2 bg-green-50 text-green-800
                        px-4 py-2 rounded-full border border-green-200 hover:bg-green-100 cursor-pointer"
                >
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none"
                    viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M3 7v10a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V7
                            a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2z"/>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M8 13l2 2 4-4"/>
                </svg>
                Upload Image
                <input type="file" id="document_image" name="document_image" accept="image/*" class="hidden" />
                </label>
            </div>
        </form>

        <!-- Search Examples -->
        <div class="mt-8 p-6 bg-gray-50 rounded-xl">
            <h4 class="font-semibold text-gray-700 mb-3">Example searches:</h4>
            <div class="flex flex-wrap gap-2">
                <button onclick="fillSearch('invoices from last month')" class="px-4 py-2 bg-white border border-gray-200 rounded-lg text-sm hover:bg-gray-100 transition duration-200">
                    invoices from last month
                </button>
                <button onclick="fillSearch('contracts over 100k')" class="px-4 py-2 bg-white border border-gray-200 rounded-lg text-sm hover:bg-gray-100 transition duration-200">
                    contracts over 100k
                </button>
                <button onclick="fillSearch('documents from ABC Company')" class="px-4 py-2 bg-white border border-gray-200 rounded-lg text-sm hover:bg-gray-100 transition duration-200">
                    documents from ABC Company
                </button>
            </div>
        </div>

        <!-- Display Search Results -->
        {% if documents %}
            <div class="bg-white p-6 rounded-lg shadow-lg mt-6">
                <h3 class="text-xl font-semibold mb-4">Results for: "{{ search_query }}"</h3>
                <ul class="space-y-4">
                    {% for document in results %}
                        <li class="border-b pb-3 pt-2">
                            <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-2">
                                <div>
                                    <h4 class="font-semibold text-green-800">{{ document.document_name }}</h4>
                                    <p class="text-gray-600 text-sm mt-1 mb-2">
                                        {{ document.ocr_text|truncatewords:30 }}
                                    </p>
                                </div>
                                <a href="{% url 'search_documents' %}"
                                   class="text-green-700 font-medium hover:underline flex items-center gap-1">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                              d="M15 12H3m0 0l4-4m-4 4l4 4m13-4a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                    View details
                                </a>
                            </div>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        {% elif search_query %}
            <div class="bg-white p-6 rounded-lg shadow-lg mt-6">
                <p class="text-red-500">No documents found matching your search query.</p>
            </div>
        {% endif %}

    </div>
</div>
{% endblock %}
